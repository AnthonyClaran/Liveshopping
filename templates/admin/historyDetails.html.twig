<div class="invoice-container">
    <!-- Infos client & vendeur -->
    <div class="invoice-infos">
        <div class="client">
            <h4 data-i18n="billed_to">Facturé à</h4>
            <p>
                <strong>{{ sale.commande.client.username }}</strong><br>
                {{ sale.commande.client.email }}<br>
                {{ sale.commande.client.contact }}<br>
                {{ sale.commande.client.address }}, {{ sale.commande.client.country }}
            </p>
        </div>
        <div class="seller">
            <h4 data-i18n="sold_by">Vendu par</h4>
            <p>
                <strong>{{ sale.commande.seller.username }}</strong><br>
                {{ sale.commande.seller.email }}<br>
                {{ sale.commande.seller.contact }}<br>
                <span data-i18n="certified_seller">Vendeur certifié</span>
            </p>
        </div>
    </div>

    <!-- Statut -->
    <div class="invoice-status">
        <span class="badge info">{{ sale.commande.state.nameState }}</span>
        {% if sale.isPaid %}
            <span class="badge success" data-i18n="paid">Payé</span>
        {% else %}
            <span class="badge warning" data-i18n="pending_payment">En attente de paiement</span>
        {% endif %}
    </div>

    <!-- Tableau des articles -->
    <div class="invoice-table-container">
        <table class="invoice-table">
            <thead>
                <tr>
                    <th data-i18n="product">Produit</th>
                    <th data-i18n="size">Taille</th>
                    <th data-i18n="quantity">Quantité</th>
                    <th data-i18n="unit_price">Prix unitaire</th>
                    <th data-i18n="total">Total</th>
                </tr>
            </thead>
            <tbody>
                {% set total = 0 %}
                {% for detail in sale.commande.details %}
                    {% set lineTotal = detail.quantity * detail.price %}
                    {% set total = total + lineTotal %}
                    <tr>
                        <td>{{ detail.itemSize.item.nameItem }}</td>
                        <td>{{ detail.itemSize.valueSize }}</td>
                        <td>{{ detail.quantity }}</td>
                        <td>{{ detail.price|number_format(2, ',', ' ') }} €</td>
                        <td>{{ lineTotal|number_format(2, ',', ' ') }} €</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Totaux -->
    {% set tvaRate = 0.20 %}
    {% set totalTTC = total %}
    {% set totalHT = totalTTC / (1 + tvaRate) %}
    {% set tva = totalTTC - totalHT %}
    <div class="invoice-totals">
        <p style="margin: 0; color: #6b7280; font-size: 0.9rem;"><span data-i18n="total_ht">Total HT</span> : {{ totalHT|number_format(2, ',', ' ') }} €</p>
        <p style="margin: 4px 0 0; color: #6b7280; font-size: 0.9rem;"><span data-i18n="vat">TVA</span> ({{ (tvaRate * 100)|number_format(0, ',', ' ') }}%) : {{ tva|number_format(2, ',', ' ') }} €</p>
        <h4 style="margin-top: 8px;"><span data-i18n="total_ttc">Total TTC</span> : {{ totalTTC|number_format(2, ',', ' ') }} €</h4>
    </div>
</div>
